trigger:
  - main

pool:
  vmImage: "windows-latest"

variables:
  # solution: '**/*.sln'
  # buildPlatform: 'Any CPU'
  buildConfiguration: "Release"

steps:
  - task: DotNetCoreCLI@2
    inputs:
      command: "restore"
      feedsToUse: "select"
      vstsFeed: "my-vsts-feed"

  - task: DotNetCoreCLI@2
    inputs:
      command: "build"
      arguments: "--configuration $(buildConfiguration)"
    displayName: "dotnet build $(buildConfiguration)"

  - task: DotNetCoreCLI@2
    inputs:
      command: publish
      publishWebProjects: True
      arguments: "--configuration $(BuildConfiguration) --output $(Build.ArtifactStagingDirectory)"
      zipAfterPublish: True

  # - task: PublishBuildArtifacts@1
  #   inputs:
  #     pathtoPublish: '$(Build.ArtifactStagingDirectory)'
  #     artifactName: 'myWebsiteName'

  - task: DotNetCoreCLI@2
    inputs:
      command: publish
      publishWebProjects: True
      arguments: "--configuration $(BuildConfiguration) --output $(Build.ArtifactStagingDirectory)"
      zipAfterPublish: True

  - task: AzureWebApp@1
    inputs:
      azureSubscription: "<Azure service connection>"
      appName: "TechnicalDocuIndexerWeb"
      package: $(System.DefaultWorkingDirectory)/**/*.zip
